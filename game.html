<!doctype html>

<head>
  <title>gravity switch</title>
  <h1>just keep switching`</h1>
  <script src="player.js"></script>
  <script src="platform.js"></script>
</head>

<style>
  body {

    /* background-repeat: none; */
    background-size: 100vw 100vh;
    background-color: black;
    text-align: center;

  }

  button {
    display: block;
    margin: 10px auto;
    width: 10%;
    font-size: 20px;
    color: black;
    background-color: firebrick;

  }

  canvas {
    display: block;
    margin: 10vh auto;


  }

  h1 {
    color: violet;

  }
</style>



<body>

  <canvas id="gameCanvas" width="800" height="600">


  </canvas>

</body>
<button onclick="location.reload();">Respawn</button>
<script>
  var canvas, canvasContext;

  window.onload = function () {

    canvas = document.getElementById('gameCanvas');
    canvasContext = canvas.getContext('2d');

    document.addEventListener('keydown', keyPressed);
    document.addEventListener('keyup', keyReleased);

    setInterval(mainloop, 1000 / 50);
  }

  var username = "";
  while (username == '' || username == null) {
    username = prompt('what is your name?');
  }

  var difficulty = '';
        var difficultypass = false;
        while (difficultypass == false) {
            difficulty = prompt("select the difficulty: easy, medium, hard", "easy");

            difficulty = difficulty.toLowerCase()

            if (difficulty == 'easy' || difficulty == 'medium' || difficulty == 'hard') {
                difficultypass = true;
            }
        }



            //  {
                // colorRect(0, 0, canvas.width, canvas.height, 'black');
                // drawtext('Game over ' + userName + ' your score was ' + score, canvas.width * 0.2, canvas.height / 2, '25px century gothic', 'red'); //be death screen 
            // }


        //enemy difficulties

        var maxSpeed = 0;
        var minSpeed = 0;

        if (difficulty == 'easy') {
            maxSpeed = 7;
            minSpeed = 2;
        }

        if (difficulty == 'medium') {
            maxSpeed = 8;
            minSpeed = 3;
        }
        if (difficulty == 'hard') {
            maxSpeed = 12;
            minSpeed = 5;
        }


  var pXpos = 380;
  var pYpos = 300;
  var pXspeed = 5;
  var pYspeed = 5;
  const P_SIZE = 50;
  var gravityRate = 0.3;

  var obstacle = 0.3;




  // key code
  const LEFT_KEY = 65;
  const RIGHT_KEY = 68;
  const SPACE_KEY = 32;
  var leftPressed = false;
  var rightPressed = false;
  var spacePressed = false;
  var score = 0;




  var playerImg = new Image();
  playerImg.src = 'images/sprite.png';

  var playerImg2 = new Image();
  playerImg2.src = 'images/sprite2.png';

  var imgMode = 0;
  var playerImgs = [playerImg, playerImg2]

  var player = new Player(playerImgs[imgMode], pXpos, pYpos, P_SIZE, P_SIZE, 'red', pXspeed, pYspeed, gravityRate,
    imgMode);

  var BG = new Image();
  BG.src = 'images/BG.jpg';

  var setUp = true;

  function mainloop() {

    if (setUp) {
      for (var i = 0; i < 10; i++) {
        makePlatforms();
      }
      setUp = false;
    }
    // colorRect(0, 0, canvas.width, canvas.height, 'grey');
    drawImgs(BG, 0, 0, canvas.width, canvas.height);
    // drawImage(BG, 0, 0, canvas.Width, canvas.heisght);

    player.drawimgs(player.playerImgs, player.pXpos, player.pYpos, player.P_SIZE, player.P_SIZE) // player
    player.playerMove();
    player.hasCollided();

    if (spacePressed && holding == false) {
      player.changeGravity();
    }

    if(platforms.length > 0){
      platforms.forEach(function(plat,i,array){
        plat.drawPlat();
        plat.movePlat();
      });
    }


  }

  var holding = false;

  function keyPressed(evt) {
    if (evt.keyCode == LEFT_KEY) {
      leftPressed = true;
    }
    if (evt.keyCode == RIGHT_KEY) {
      rightPressed = true;
    }
    if (evt.keyCode == SPACE_KEY) {
      spacePressed = true;
    }
  }

  function drawtext(msg, x, y, f, c) {
    canvasContext.font = f;
    canvasContext.fillStyle = c;
    canvasContext.filltext(msg, x, y);

  }



  function keyReleased(evt) {
    if (evt.keyCode == LEFT_KEY) {
      leftPressed = false;
    }
    if (evt.keyCode == RIGHT_KEY) {
      rightPressed = false;
    }
    if (evt.keyCode == SPACE_KEY) {
      holding = false;
      spacePressed = false;
    }
  }

  function colorRect(x, y, w, h, c) {
    canvasContext.fillStyle = c;
    canvasContext.fillRect(x, y, w, h);
  }

  function drawImgs(src, x, y, w, h) {
    canvasContext.drawImage(src, x, y, w, h);
  }

  var platCounter = 0;
  var platforms = [];

  function makePlatforms() {
    var platLength = Math.floor(Math.random() * (canvas.width * 0.4 - canvas.width * 0.25) + canvas.width * 0.25);
    var platHeight = 20;
    var platXpos = canvas.width + platCounter * platLength;
    var platYpos = 0;

    if (platCounter % 2 == 0 || platCounter == 0) {
      platYpos = 0 + Math.floor(Math.random() * (platHeight * 3));
    } else {
      platYpos = canvas.height - Math.floor(Math.random() * (platHeight * 4));
    }

    if (platYpos + platHeight> P_SIZE) {
      console.log('hit');
    }

    var platXspeed = Math.floor(Math.random() * (4 - 2) + 2);

    platCounter++
    var platform = {
       platXpos: platXpos,
      platYpos: platYpos,
       platLength: platLength,
       platHeight: platHeight,
       platXspeed: platXspeed
     }

    var platform = new Platform(platXpos, platYpos, platLength, platHeight, "black", platXspeed)

    platforms.push(platform);

  }
</script>